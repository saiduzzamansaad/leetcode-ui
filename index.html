<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Parking System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .car {
            transition: all 0.5s ease;
        }
        .parking-spot {
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .parking-spot.occupied {
            background-color: #fecaca;
        }
        .parking-spot.available {
            background-color: #bbf7d0;
        }
        .car-entering {
            animation: carEnter 1s forwards;
        }
        @keyframes carEnter {
            0% { transform: translateX(-100px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        .car-exiting {
            animation: carExit 1s forwards;
        }
        @keyframes carExit {
            0% { transform: translateX(0); opacity: 1; }
            100% { transform: translateX(100px); opacity: 0; }
        }
        .toast {
            animation: toastIn 0.5s forwards, toastOut 0.5s forwards 2.5s;
        }
        @keyframes toastIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes toastOut {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-20px); opacity: 0; }
        }
        .parking-lot {
            background-image: linear-gradient(45deg, #eee 25%, transparent 25%), 
                              linear-gradient(-45deg, #eee 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #eee 75%), 
                              linear-gradient(-45deg, transparent 75%, #eee 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        .glow {
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
        .dashboard-card {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.8);
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .rotate {
            animation: rotate 10s linear infinite;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .bounce {
            animation: bounce 0.5s;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-gray-100 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="text-center mb-12 relative">
            <div class="absolute top-0 right-0 text-sm bg-blue-100 text-blue-800 px-3 py-1 rounded-full animate__animated animate__fadeInRight animate__delay-1s">
                <i class="fas fa-bolt mr-1"></i> LIVE SYSTEM
            </div>
            <div class="inline-block bg-white p-4 rounded-full shadow-lg mb-4 animate__animated animate__bounceIn floating">
                <i class="fas fa-parking text-5xl text-blue-600"></i>
            </div>
            <h1 class="text-5xl font-bold text-gray-800 mb-2 animate__animated animate__fadeInDown bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600">
                Ultimate Parking System
            </h1>
            <p class="text-xl text-gray-600 animate__animated animate__fadeIn animate__delay-1s">
                Advanced parking management with AI analytics
            </p>
        </header>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
            <!-- Configuration Panel -->
            <div class="dashboard-card col-span-1 rounded-2xl shadow-xl p-6 animate__animated animate__fadeInLeft pulse">
                <div class="flex items-center mb-6">
                    <div class="bg-blue-100 p-3 rounded-full mr-4">
                        <i class="fas fa-cog text-blue-600 text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-800">Parking Configuration</h2>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            <i class="fas fa-car-alt text-red-500 mr-2"></i> Big Spaces (Type 1)
                        </label>
                        <div class="flex items-center">
                            <input type="range" id="bigRange" min="0" max="20" value="5" 
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mr-4">
                            <input type="number" id="bigSpaces" min="0" max="1000" value="5" 
                                   class="w-20 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            <i class="fas fa-car-side text-yellow-500 mr-2"></i> Medium Spaces (Type 2)
                        </label>
                        <div class="flex items-center">
                            <input type="range" id="mediumRange" min="0" max="20" value="5" 
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mr-4">
                            <input type="number" id="mediumSpaces" min="0" max="1000" value="5" 
                                   class="w-20 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            <i class="fas fa-car text-green-500 mr-2"></i> Small Spaces (Type 3)
                        </label>
                        <div class="flex items-center">
                            <input type="range" id="smallRange" min="0" max="20" value="5" 
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mr-4">
                            <input type="number" id="smallSpaces" min="0" max="1000" value="5" 
                                   class="w-20 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        <i class="fas fa-clock text-purple-500 mr-2"></i> Simulation Speed
                    </label>
                    <select id="simulationSpeed" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="1000">Normal (1x)</option>
                        <option value="500">Fast (2x)</option>
                        <option value="200">Turbo (5x)</option>
                        <option value="100">Ludicrous (10x)</option>
                    </select>
                </div>
                
                <div class="mt-6 grid grid-cols-2 gap-4">
                    <button id="initBtn" class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-3 px-4 rounded-xl transition duration-300 transform hover:scale-[1.02] shadow-md flex items-center justify-center">
                        <i class="fas fa-play-circle mr-2"></i> Initialize
                    </button>
                    <button id="resetBtn" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-4 rounded-xl transition duration-300 transform hover:scale-[1.02] shadow-md flex items-center justify-center">
                        <i class="fas fa-redo mr-2"></i> Reset
                    </button>
                </div>
            </div>
            
            <!-- Visualization Panel -->
            <div class="dashboard-card col-span-2 rounded-2xl shadow-xl p-6 animate__animated animate__fadeInRight">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <div class="bg-indigo-100 p-3 rounded-full mr-4">
                            <i class="fas fa-project-diagram text-indigo-600 text-xl"></i>
                        </div>
                        <h2 class="text-2xl font-semibold text-gray-800">Parking Visualization</h2>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="autoParkBtn" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 transform hover:scale-[1.02] shadow-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-robot mr-2"></i> Auto Park
                        </button>
                        <button id="removeRandomBtn" class="bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 transform hover:scale-[1.02] shadow-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-sign-out-alt mr-2"></i> Remove Random
                        </button>
                    </div>
                </div>
                
                <div class="relative h-64 parking-lot rounded-xl overflow-hidden mb-6" id="parkingVisualization">
                    <div class="absolute inset-0 flex items-center justify-center text-gray-400">
                        <div class="text-center p-6 bg-white bg-opacity-80 rounded-lg">
                            <i class="fas fa-parking text-4xl text-gray-300 mb-2"></i>
                            <p>Parking visualization will appear here</p>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4 mb-6" id="parkingStatus">
                    <!-- Status cards will be populated here -->
                    <div class="bg-white p-4 rounded-lg border border-gray-200 text-center">
                        <div class="text-4xl mb-2 text-red-500"><i class="fas fa-car-alt"></i></div>
                        <h3 class="font-medium text-gray-800">Big Spaces</h3>
                        <p class="text-sm text-gray-600">Not initialized</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 text-center">
                        <div class="text-4xl mb-2 text-yellow-500"><i class="fas fa-car-side"></i></div>
                        <h3 class="font-medium text-gray-800">Medium Spaces</h3>
                        <p class="text-sm text-gray-600">Not initialized</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 text-center">
                        <div class="text-4xl mb-2 text-green-500"><i class="fas fa-car"></i></div>
                        <h3 class="font-medium text-gray-800">Small Spaces</h3>
                        <p class="text-sm text-gray-600">Not initialized</p>
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-4">
                    <button id="addBigCar" class="flex-1 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white font-bold py-3 px-6 rounded-xl transition duration-300 transform hover:scale-[1.02] shadow-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fas fa-car-alt mr-2"></i> Add Big Car
                    </button>
                    <button id="addMediumCar" class="flex-1 bg-gradient-to-r from-yellow-500 to-amber-500 hover:from-yellow-600 hover:to-amber-600 text-white font-bold py-3 px-6 rounded-xl transition duration-300 transform hover:scale-[1.02] shadow-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fas fa-car-side mr-2"></i> Add Medium Car
                    </button>
                    <button id="addSmallCar" class="flex-1 bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white font-bold py-3 px-6 rounded-xl transition duration-300 transform hover:scale-[1.02] shadow-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fas fa-car mr-2"></i> Add Small Car
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Analytics Panel -->
        <div class="dashboard-card rounded-2xl shadow-xl p-6 mb-8 animate__animated animate__fadeInUp">
            <div class="flex items-center mb-6">
                <div class="bg-purple-100 p-3 rounded-full mr-4">
                    <i class="fas fa-chart-line text-purple-600 text-xl"></i>
                </div>
                <h2 class="text-2xl font-semibold text-gray-800">Parking Analytics</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-4 rounded-xl border border-gray-200">
                    <h3 class="font-medium text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-history text-blue-500 mr-2"></i> Operation Log
                    </h3>
                    <div class="h-48 overflow-y-auto bg-gray-50 p-3 rounded-lg" id="operationLog">
                        <div class="text-center text-gray-400 py-8">
                            <i class="fas fa-info-circle text-2xl mb-2"></i>
                            <p>System logs will appear here</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-4 rounded-xl border border-gray-200">
                    <h3 class="font-medium text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-chart-pie text-orange-500 mr-2"></i> Occupancy Stats
                    </h3>
                    <div class="h-48 flex items-center justify-center" id="statsChart">
                        <div class="text-center text-gray-400">
                            <i class="fas fa-chart-bar text-2xl mb-2"></i>
                            <p>Occupancy statistics will appear here</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-4 rounded-xl border border-gray-200">
                    <h3 class="font-medium text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-chart-area text-green-500 mr-2"></i> Revenue Calculator
                    </h3>
                    <div class="h-48 flex flex-col justify-between" id="revenueCalculator">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Hourly Rate ($)</label>
                                <input type="number" id="hourlyRate" min="1" value="5" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Average Stay (hours)</label>
                                <input type="number" id="avgStay" min="1" value="2" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                        </div>
                        <div class="text-center">
                            <button id="calculateRevenue" class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white font-bold py-2 px-4 rounded-lg">
                                Calculate Revenue
                            </button>
                            <div id="revenueResult" class="mt-2 text-xl font-bold text-green-600 hidden">
                                $<span id="revenueAmount">0</span>/day
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Parking History Timeline -->
        <div class="dashboard-card rounded-2xl shadow-xl p-6 animate__animated animate__fadeIn">
            <div class="flex items-center mb-6">
                <div class="bg-blue-100 p-3 rounded-full mr-4">
                    <i class="fas fa-history text-blue-600 text-xl"></i>
                </div>
                <h2 class="text-2xl font-semibold text-gray-800">Parking Timeline</h2>
            </div>
            <div class="h-48 overflow-y-auto bg-white p-4 rounded-lg" id="timeline">
                <div class="text-center text-gray-400 py-8">
                    <i class="fas fa-clock text-2xl mb-2"></i>
                    <p>Parking events timeline will appear here</p>
                </div>
            </div>
        </div>
    </div>

    <div id="toastContainer" class="fixed bottom-4 right-4 space-y-2 z-50"></div>

    <script>
        // Define ParkingSystem class first to avoid reference error
        class ParkingSystem {
            constructor(big, medium, small) {
                this.spaces = {
                    1: big,
                    2: medium,
                    3: small
                };
                this.initialSpaces = {
                    1: big,
                    2: medium,
                    3: small
                };
                this.occupancyHistory = [];
                this.parkedCars = [];
                this.revenue = 0;
                this.totalCarsParked = 0;
                this.totalCarsRejected = 0;
            }

            addCar(carType) {
                if (this.spaces[carType] > 0) {
                    const carId = Date.now() + Math.floor(Math.random() * 1000);
                    this.spaces[carType]--;
                    this.parkedCars.push({
                        id: carId,
                        type: carType,
                        entryTime: new Date()
                    });
                    this.totalCarsParked++;
                    this.recordOccupancy();
                    return { success: true, carId };
                }
                this.totalCarsRejected++;
                return { success: false };
            }

            removeCar(carId) {
                const carIndex = this.parkedCars.findIndex(car => car.id === carId);
                if (carIndex !== -1) {
                    const car = this.parkedCars[carIndex];
                    this.spaces[car.type]++;
                    this.parkedCars.splice(carIndex, 1);
                    this.recordOccupancy();
                    return { success: true, carType: car.type };
                }
                return { success: false };
            }

            removeRandomCar() {
                if (this.parkedCars.length > 0) {
                    const randomIndex = Math.floor(Math.random() * this.parkedCars.length);
                    return this.removeCar(this.parkedCars[randomIndex].id);
                }
                return { success: false };
            }

            recordOccupancy() {
                this.occupancyHistory.push({
                    timestamp: new Date(),
                    big: this.initialSpaces[1] - this.spaces[1],
                    medium: this.initialSpaces[2] - this.spaces[2],
                    small: this.initialSpaces[3] - this.spaces[3]
                });
            }

            getOccupancyRate() {
                return {
                    big: ((this.initialSpaces[1] - this.spaces[1]) / this.initialSpaces[1]) * 100,
                    medium: ((this.initialSpaces[2] - this.spaces[2]) / this.initialSpaces[2]) * 100,
                    small: ((this.initialSpaces[3] - this.spaces[3]) / this.initialSpaces[3]) * 100
                };
            }

            calculateProjectedRevenue(hourlyRate, avgStayHours) {
                const occupiedSpots = (this.initialSpaces[1] - this.spaces[1]) + 
                                     (this.initialSpaces[2] - this.spaces[2]) + 
                                     (this.initialSpaces[3] - this.spaces[3]);
                return Math.round(occupiedSpots * hourlyRate * avgStayHours * 1.2); // 1.2 factor for turnover
            }
        }

        // DOM elements
        const initBtn = document.getElementById('initBtn');
        const resetBtn = document.getElementById('resetBtn');
        const addBigCarBtn = document.getElementById('addBigCar');
        const addMediumCarBtn = document.getElementById('addMediumCar');
        const addSmallCarBtn = document.getElementById('addSmallCar');
        const autoParkBtn = document.getElementById('autoParkBtn');
        const removeRandomBtn = document.getElementById('removeRandomBtn');
        const calculateRevenueBtn = document.getElementById('calculateRevenue');
        
        // Range and number input sync
        document.getElementById('bigRange').addEventListener('input', (e) => {
            document.getElementById('bigSpaces').value = e.target.value;
        });
        document.getElementById('mediumRange').addEventListener('input', (e) => {
            document.getElementById('mediumSpaces').value = e.target.value;
        });
        document.getElementById('smallRange').addEventListener('input', (e) => {
            document.getElementById('smallSpaces').value = e.target.value;
        });
        
        document.getElementById('bigSpaces').addEventListener('input', (e) => {
            const value = Math.min(Math.max(e.target.value, 0), 1000);
            document.getElementById('bigRange').value = value > 20 ? 20 : value;
        });
        document.getElementById('mediumSpaces').addEventListener('input', (e) => {
            const value = Math.min(Math.max(e.target.value, 0), 1000);
            document.getElementById('mediumRange').value = value > 20 ? 20 : value;
        });
        document.getElementById('smallSpaces').addEventListener('input', (e) => {
            const value = Math.min(Math.max(e.target.value, 0), 1000);
            document.getElementById('smallRange').value = value > 20 ? 20 : value;
        });

        // App state
        let parkingSystem;
        let autoParkInterval;
        let simulationSpeed = 1000;
        const carIcons = {
            1: '<i class="fas fa-car-alt text-red-500"></i>',
            2: '<i class="fas fa-car-side text-yellow-500"></i>',
            3: '<i class="fas fa-car text-green-500"></i>'
        };
        const carColors = {
            1: 'bg-red-200',
            2: 'bg-yellow-200',
            3: 'bg-green-200'
        };
        const carTypeNames = {
            1: 'Big',
            2: 'Medium',
            3: 'Small'
        };
        let chart = null;

        // Event listeners
        initBtn.addEventListener('click', initializeParkingSystem);
        resetBtn.addEventListener('click', resetParkingSystem);
        addBigCarBtn.addEventListener('click', () => addCar(1));
        addMediumCarBtn.addEventListener('click', () => addCar(2));
        addSmallCarBtn.addEventListener('click', () => addCar(3));
        autoParkBtn.addEventListener('click', toggleAutoPark);
        removeRandomBtn.addEventListener('click', removeRandomCar);
        calculateRevenueBtn.addEventListener('click', calculateRevenue);
        document.getElementById('simulationSpeed').addEventListener('change', (e) => {
            simulationSpeed = parseInt(e.target.value);
            if (autoParkInterval) {
                clearInterval(autoParkInterval);
                startAutoPark();
            }
        });

        function initializeParkingSystem() {
            const big = parseInt(document.getElementById('bigSpaces').value);
            const medium = parseInt(document.getElementById('mediumSpaces').value);
            const small = parseInt(document.getElementById('smallSpaces').value);
            
            parkingSystem = new ParkingSystem(big, medium, small);
            
            // Enable car buttons
            addBigCarBtn.disabled = false;
            addMediumCarBtn.disabled = false;
            addSmallCarBtn.disabled = false;
            autoParkBtn.disabled = false;
            removeRandomBtn.disabled = false;
            
            // Update UI
            updateParkingStatus();
            updateParkingVisualization();
            updateStatsChart();
            
            // Add to log
            addToLog(`System initialized with ${big} big, ${medium} medium, and ${small} small spaces.`, 'system');
            addToTimeline('System initialized', 'fas fa-play-circle', 'text-blue-500');
            
            showToast('Parking system initialized successfully!', 'bg-blue-500', 'fas fa-check-circle');
            
            // Animate the init button
            initBtn.classList.add('animate__animated', 'animate__pulse');
            setTimeout(() => {
                initBtn.classList.remove('animate__animated', 'animate__pulse');
            }, 1000);
        }

        function resetParkingSystem() {
            if (autoParkInterval) {
                clearInterval(autoParkInterval);
                autoParkInterval = null;
                autoParkBtn.innerHTML = '<i class="fas fa-robot mr-2"></i> Auto Park';
            }
            
            parkingSystem = null;
            
            // Disable car buttons
            addBigCarBtn.disabled = true;
            addMediumCarBtn.disabled = true;
            addSmallCarBtn.disabled = true;
            autoParkBtn.disabled = true;
            removeRandomBtn.disabled = true;
            
            // Reset UI
            updateParkingStatus();
            updateParkingVisualization();
            updateStatsChart();
            
            // Clear timeline
            document.getElementById('timeline').innerHTML = `
                <div class="text-center text-gray-400 py-8">
                    <i class="fas fa-clock text-2xl mb-2"></i>
                    <p>Parking events timeline will appear here</p>
                </div>
            `;
            
            // Add to log
            addToLog('System has been reset', 'system');
            addToTimeline('System reset', 'fas fa-redo', 'text-gray-500');
            
            showToast('Parking system has been reset', 'bg-gray-500', 'fas fa-redo');
        }

        function toggleAutoPark() {
            if (autoParkInterval) {
                clearInterval(autoParkInterval);
                autoParkInterval = null;
                autoParkBtn.innerHTML = '<i class="fas fa-robot mr-2"></i> Auto Park';
                addToLog('Auto parking mode deactivated', 'info');
                addToTimeline('Auto park stopped', 'fas fa-robot', 'text-purple-500');
                showToast('Auto parking stopped', 'bg-purple-500', 'fas fa-robot');
            } else {
                startAutoPark();
                autoParkBtn.innerHTML = '<i class="fas fa-stop-circle mr-2"></i> Stop Auto';
                addToLog('Auto parking mode activated', 'info');
                addToTimeline('Auto park started', 'fas fa-robot', 'text-purple-500');
                showToast('Auto parking started', 'bg-purple-500', 'fas fa-robot');
            }
        }

        function startAutoPark() {
            autoParkInterval = setInterval(() => {
                // Randomly decide to add or remove a car (70% chance to add)
                if (Math.random() < 0.7 || parkingSystem.parkedCars.length === 0) {
                    // Add a random car
                    const carType = Math.floor(Math.random() * 3) + 1;
                    addCar(carType);
                } else {
                    // Remove a random car
                    removeRandomCar();
                }
            }, simulationSpeed);
        }

        function addCar(carType) {
            if (!parkingSystem) {
                showToast('Please initialize the parking system first!', 'bg-red-500', 'fas fa-exclamation-circle');
                return;
            }
            
            const result = parkingSystem.addCar(carType);
            updateParkingStatus();
            updateParkingVisualization();
            updateStatsChart();
            
            const carTypeName = carTypeNames[carType];
            if (result.success) {
                addToLog(`Parked ${carTypeName} car (Type ${carType})`, 'success');
                addToTimeline(`${carTypeName} car parked`, carType === 1 ? 'fas fa-car-alt' : carType === 2 ? 'fas fa-car-side' : 'fas fa-car', 
                             carType === 1 ? 'text-red-500' : carType === 2 ? 'text-yellow-500' : 'text-green-500');
                showToast(`${carTypeName} car parked successfully!`, 'bg-green-500', 'fas fa-check-circle');
                
                // Add visual car to parking lot
                const parkingViz = document.getElementById('parkingVisualization');
                const carElement = document.createElement('div');
                carElement.className = `car absolute bottom-4 ${carColors[carType]} p-3 rounded-lg border-2 border-white animate__animated animate__fadeInRight flex items-center justify-center text-xl`;
                carElement.innerHTML = carIcons[carType];
                carElement.style.left = `${Math.random() * 80 + 10}%`;
                carElement.dataset.carId = result.carId;
                parkingViz.appendChild(carElement);
                
                // Animate car entering
                carElement.classList.add('car-entering');
                
                // Animate the button
                const btn = carType === 1 ? addBigCarBtn : carType === 2 ? addMediumCarBtn : addSmallCarBtn;
                btn.classList.add('animate__animated', 'animate__pulse');
                setTimeout(() => {
                    btn.classList.remove('animate__animated', 'animate__pulse');
                }, 500);
            } else {
                addToLog(`Failed to park ${carTypeName} car - no available space`, 'error');
                addToTimeline(`${carTypeName} car rejected`, 'fas fa-times', 'text-red-500');
                showToast(`No space available for ${carTypeName} car!`, 'bg-red-500', 'fas fa-times-circle');
                
                // Show rejected car animation
                const parkingViz = document.getElementById('parkingVisualization');
                const rejectedCar = document.createElement('div');
                rejectedCar.className = `car absolute bottom-4 ${carColors[carType]} p-3 rounded-lg border-2 border-white animate__animated animate__shakeX flex items-center justify-center text-xl`;
                rejectedCar.innerHTML = `${carIcons[carType]} <i class="fas fa-times text-red-500 ml-2"></i>`;
                rejectedCar.style.left = '50%';
                rejectedCar.style.transform = 'translateX(-50%)';
                parkingViz.appendChild(rejectedCar);
                
                setTimeout(() => {
                    rejectedCar.remove();
                }, 2000);
            }
        }

        function removeRandomCar() {
            if (!parkingSystem) {
                showToast('Please initialize the parking system first!', 'bg-red-500', 'fas fa-exclamation-circle');
                return;
            }
            
            const result = parkingSystem.removeRandomCar();
            if (result.success) {
                const carTypeName = carTypeNames[result.carType];
                addToLog(`Removed random ${carTypeName} car`, 'info');
                addToTimeline(`${carTypeName} car removed`, 'fas fa-sign-out-alt', 
                             result.carType === 1 ? 'text-red-500' : result.carType === 2 ? 'text-yellow-500' : 'text-green-500');
                showToast(`Random ${carTypeName} car removed!`, 'bg-orange-500', 'fas fa-sign-out-alt');
                
                // Find and animate car exiting
                const parkingViz = document.getElementById('parkingVisualization');
                const cars = parkingViz.querySelectorAll('.car');
                if (cars.length > 0) {
                    const randomCar = cars[Math.floor(Math.random() * cars.length)];
                    randomCar.classList.remove('animate__fadeInRight');
                    randomCar.classList.add('animate__animated', 'animate__fadeOutRight');
                    setTimeout(() => {
                        randomCar.remove();
                    }, 1000);
                }
                
                updateParkingStatus();
                updateParkingVisualization();
                updateStatsChart();
                
                // Animate the remove button
                removeRandomBtn.classList.add('animate__animated', 'animate__bounce');
                setTimeout(() => {
                    removeRandomBtn.classList.remove('animate__animated', 'animate__bounce');
                }, 1000);
            } else {
                addToLog('No cars to remove', 'info');
                showToast('No cars parked to remove!', 'bg-yellow-500', 'fas fa-info-circle');
            }
        }

        function calculateRevenue() {
            if (!parkingSystem) {
                showToast('Please initialize the parking system first!', 'bg-red-500', 'fas fa-exclamation-circle');
                return;
            }
            
            const hourlyRate = parseFloat(document.getElementById('hourlyRate').value);
            const avgStay = parseFloat(document.getElementById('avgStay').value);
            
            if (isNaN(hourlyRate) || isNaN(avgStay)) {
                showToast('Please enter valid numbers', 'bg-red-500', 'fas fa-exclamation-circle');
                return;
            }
            
            const revenue = parkingSystem.calculateProjectedRevenue(hourlyRate, avgStay);
            document.getElementById('revenueAmount').textContent = revenue.toLocaleString();
            document.getElementById('revenueResult').classList.remove('hidden');
            
            addToLog(`Calculated projected revenue: $${revenue}/day`, 'info');
            addToTimeline('Revenue calculated', 'fas fa-dollar-sign', 'text-green-500');
            showToast(`Projected revenue: $${revenue}/day`, 'bg-green-500', 'fas fa-dollar-sign');
            
            // Animate the result
            document.getElementById('revenueResult').classList.add('animate__animated', 'animate__bounce');
            setTimeout(() => {
                document.getElementById('revenueResult').classList.remove('animate__animated', 'animate__bounce');
            }, 1000);
        }

        function updateParkingStatus() {
            const statusContainer = document.getElementById('parkingStatus');
            statusContainer.innerHTML = '';
            
            for (let type = 1; type <= 3; type++) {
                if (!parkingSystem) {
                    // Show placeholder if system not initialized
                    const statusElement = document.createElement('div');
                    statusElement.className = 'bg-white p-4 rounded-lg border border-gray-200 text-center';
                    statusElement.innerHTML = `
                        <div class="text-4xl mb-2 ${type === 1 ? 'text-red-500' : type === 2 ? 'text-yellow-500' : 'text-green-500'}">
                            ${type === 1 ? '<i class="fas fa-car-alt"></i>' : type === 2 ? '<i class="fas fa-car-side"></i>' : '<i class="fas fa-car"></i>'}
                        </div>
                        <h3 class="font-medium text-gray-800">${carTypeNames[type]} Spaces</h3>
                        <p class="text-sm text-gray-600">Not initialized</p>
                    `;
                    statusContainer.appendChild(statusElement);
                    continue;
                }
                
                const available = parkingSystem.spaces[type];
                const total = parkingSystem.initialSpaces[type];
                const occupied = total - available;
                const occupancyRate = total > 0 ? Math.round((occupied / total) * 100) : 0;
                
                const statusElement = document.createElement('div');
                statusElement.className = 'bg-white p-4 rounded-lg border border-gray-200';
                statusElement.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <div class="${type === 1 ? 'text-red-500' : type === 2 ? 'text-yellow-500' : 'text-green-500'} text-3xl">
                            ${carIcons[type]}
                        </div>
                        <div class="text-right">
                            <span class="text-2xl font-bold">${occupied}/${total}</span>
                            <span class="text-sm text-gray-500 block">cars parked</span>
                        </div>
                    </div>
                    <div class="mb-1 flex justify-between text-sm text-gray-600">
                        <span>${available} available</span>
                        <span>${occupancyRate}% full</span>
                    </div>
                    <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full ${type === 1 ? 'bg-red-500' : type === 2 ? 'bg-yellow-500' : 'bg-green-500'}" 
                             style="width: ${occupancyRate}%"></div>
                    </div>
                `;
                statusContainer.appendChild(statusElement);
            }
        }

        function updateParkingVisualization() {
            const parkingViz = document.getElementById('parkingVisualization');
            
            if (!parkingSystem) {
                parkingViz.innerHTML = `
                    <div class="absolute inset-0 flex items-center justify-center text-gray-400">
                        <div class="text-center p-6 bg-white bg-opacity-80 rounded-lg">
                            <i class="fas fa-parking text-4xl text-gray-300 mb-2"></i>
                            <p>Parking visualization will appear here</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            parkingViz.innerHTML = '';
            
            // Add parking spots visualization
            for (let type = 1; type <= 3; type++) {
                const totalSpots = parkingSystem.initialSpaces[type];
                const available = parkingSystem.spaces[type];
                const occupied = totalSpots - available;
                
                for (let i = 0; i < totalSpots; i++) {
                    const spot = document.createElement('div');
                    spot.className = `parking-spot absolute ${i < occupied ? 'occupied' : 'available'} 
                                      ${type === 1 ? 'h-14 w-14 bg-red-100' : 
                                       type === 2 ? 'h-12 w-12 bg-yellow-100' : 'h-10 w-10 bg-green-100'} 
                                      border-2 border-white rounded-lg flex items-center justify-center`;
                    
                    // Position spots in rows by type
                    const row = type - 1;
                    const col = i;
                    const top = 20 + row * 50;
                    const left = 20 + col * 60;
                    
                    spot.style.top = `${top}px`;
                    spot.style.left = `${left}px`;
                    
                    if (i < occupied) {
                        spot.innerHTML = carIcons[type];
                        spot.classList.add('glow');
                    }
                    
                    parkingViz.appendChild(spot);
                }
            }
            
            // Add floating cars
            parkingSystem.parkedCars.forEach(car => {
                const carElement = document.createElement('div');
                carElement.className = `car absolute bottom-4 ${carColors[car.type]} p-3 rounded-lg border-2 border-white flex items-center justify-center text-xl floating`;
                carElement.innerHTML = carIcons[car.type];
                carElement.style.left = `${Math.random() * 80 + 10}%`;
                carElement.dataset.carId = car.id;
                parkingViz.appendChild(carElement);
            });
        }

        function updateStatsChart() {
            const statsContainer = document.getElementById('statsChart');
            
            if (!parkingSystem) {
                statsContainer.innerHTML = `
                    <div class="text-center text-gray-400">
                        <i class="fas fa-chart-bar text-2xl mb-2"></i>
                        <p>Occupancy statistics will appear here</p>
                    </div>
                `;
                if (chart) {
                    chart.destroy();
                    chart = null;
                }
                return;
            }
            
            const ctx = document.createElement('canvas');
            statsContainer.innerHTML = '';
            statsContainer.appendChild(ctx);
            
            const occupancy = parkingSystem.getOccupancyRate();
            const data = {
                labels: ['Big', 'Medium', 'Small'],
                datasets: [{
                    data: [occupancy.big, occupancy.medium, occupancy.small],
                    backgroundColor: [
                        'rgba(239, 68, 68, 0.7)',
                        'rgba(234, 179, 8, 0.7)',
                        'rgba(16, 185, 129, 0.7)'
                    ],
                    borderColor: [
                        'rgba(239, 68, 68, 1)',
                        'rgba(234, 179, 8, 1)',
                        'rgba(16, 185, 129, 1)'
                    ],
                    borderWidth: 1
                }]
            };
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${Math.round(context.raw)}% occupied`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });
        }

        function addToLog(message, type = 'info') {
            const logContainer = document.getElementById('operationLog');
            
            // Clear placeholder if exists
            if (logContainer.querySelector('.text-center')) {
                logContainer.innerHTML = '';
            }
            
            const logEntry = document.createElement('div');
            logEntry.className = `text-sm py-2 px-3 mb-1 rounded-lg ${type === 'error' ? 'bg-red-50 text-red-700' : type === 'success' ? 'bg-green-50 text-green-700' : type === 'system' ? 'bg-blue-50 text-blue-700' : 'bg-gray-50 text-gray-700'}`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            logEntry.innerHTML = `
                <div class="flex items-start">
                    <span class="mr-2 ${type === 'error' ? 'text-red-500' : type === 'success' ? 'text-green-500' : type === 'system' ? 'text-blue-500' : 'text-gray-500'}">
                        ${type === 'error' ? '<i class="fas fa-times-circle"></i>' : 
                         type === 'success' ? '<i class="fas fa-check-circle"></i>' : 
                         type === 'system' ? '<i class="fas fa-cog"></i>' : '<i class="fas fa-info-circle"></i>'}
                    </span>
                    <div>
                        <span class="text-xs text-gray-500">[${timeString}]</span>
                        <div>${message}</div>
                    </div>
                </div>
            `;
            logContainer.prepend(logEntry);
            logContainer.scrollTop = 0;
        }

        function addToTimeline(message, icon, color) {
            const timeline = document.getElementById('timeline');
            
            // Clear placeholder if exists
            if (timeline.querySelector('.text-center')) {
                timeline.innerHTML = '';
            }
            
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            const event = document.createElement('div');
            event.className = 'flex items-start mb-3';
            event.innerHTML = `
                <div class="flex-shrink-0 mr-3 ${color} text-lg">
                    <i class="${icon}"></i>
                </div>
                <div class="flex-1 pt-1">
                    <div class="text-sm text-gray-800">${message}</div>
                    <div class="text-xs text-gray-500">${timeString}</div>
                </div>
            `;
            
            timeline.prepend(event);
            
            // Limit to 10 events
            if (timeline.children.length > 10) {
                timeline.removeChild(timeline.lastChild);
            }
        }

        function showToast(message, bgColor, icon = 'fas fa-info-circle') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${bgColor} text-white px-4 py-3 rounded-xl shadow-lg max-w-xs flex items-start animate__animated animate__fadeInRight`;
            toast.innerHTML = `
                <i class="${icon} mr-3 mt-1"></i>
                <div>${message}</div>
            `;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('animate__fadeOutRight');
                setTimeout(() => {
                    toast.remove();
                }, 500);
            }, 3000);
        }
    </script>
</body>
</html>